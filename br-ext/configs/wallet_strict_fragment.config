##### PiTrezor â€“ strict wallet fragment (explicit must-haves only)

# --- Core toolchain/system (keep Buildroot toolchain, glibc) ---
BR2_TOOLCHAIN_BUILDROOT_MUSL=y

# Init: BusyBox (no getty/login consoles)
BR2_INIT_BUSYBOX=y
BR2_PACKAGE_BUSYBOX=y
BR2_TARGET_GENERIC_GETTY=n

# Device management: eudev + devtmpfs (for stable HID, input, hotplug)
BR2_ROOTFS_DEVICE_CREATION_DYNAMIC_EUDEV=y
BR2_PACKAGE_EUDEV=y

# Hostname/issue (cosmetic)
BR2_TARGET_GENERIC_HOSTNAME="pitrezor"
BR2_TARGET_GENERIC_ISSUE="PiTrezor (Buildroot)"

# --- Graphics/IO needed by Trezor emulator pipeline (no X/Wayland) ---
BR2_PACKAGE_LIBDRM=y
BR2_PACKAGE_MESA3D=y
BR2_PACKAGE_MESA3D_GBM=y
BR2_PACKAGE_MESA3D_OPENGL_EGL=y
BR2_PACKAGE_MESA3D_OPENGL_ES=y

BR2_PACKAGE_SDL2=y
BR2_PACKAGE_SDL2_IMAGE=y
BR2_PACKAGE_SDL2_IMAGE_PNG=y

# Touch stack (calibration + sanity test)
BR2_PACKAGE_TSLIB=y
BR2_PACKAGE_EVTEST=y

# Simple framebuffer image viewer (for splash)
BR2_PACKAGE_FBI=y

# --- Hardened build knobs (PIE, RELRO, SSP, Fortify) ---
BR2_PIC_PIE=y
BR2_RELRO_FULL=y
BR2_SSP_STRONG=y
# Aggressive fortify (Buildroot 2024+). If unsupported in your tree, keep BR2_FORTIFY_SOURCE=y.
BR2_FORTIFY_SOURCE=y
BR2_FORTIFY_SOURCE_3=y

# Purge locales/NLS for size (wallet appliance)
BR2_SYSTEM_ENABLE_NLS=n
BR2_ENABLE_LOCALE_PURGE=y
BR2_LOCALE_PURGE_WHITELIST="C en_US en_US.UTF-8"

# --- Users & overlays (unprivileged trezor, overlay skeleton) ---
BR2_ROOTFS_USERS_TABLES="$(BR2_EXTERNAL_PITREZOR_PATH)/board/pitrezor/users.txt"
BR2_ROOTFS_OVERLAY="$(BR2_EXTERNAL_PITREZOR_PATH)/overlay"

# --- Rootfs / image output ---
# ext4 target (we mount ro via fstab/cmdline in your board files)
BR2_TARGET_ROOTFS_EXT2=y
BR2_TARGET_ROOTFS_EXT2_4=y
BR2_TARGET_ROOTFS_EXT2_LABEL="rootfs"
BR2_TARGET_ROOTFS_EXT2_SIZE="256M"
BR2_TARGET_ROOTFS_TAR=y

# post-image (genimage + boot layout) & host tools
BR2_ROOTFS_POST_IMAGE_SCRIPT="$(BR2_EXTERNAL_PITREZOR_PATH)/board/pitrezor/post-image.sh"
BR2_PACKAGE_HOST_GENIMAGE=y
BR2_PACKAGE_HOST_DOSFSTOOLS=y
BR2_PACKAGE_HOST_MTOOLS=y

# --- External packages from br-ext (wrappers) ---
# Your br-ext packages expose these names; enable the emulator daemon only.
BR2_PACKAGE_TREZORD_GO=y

# If you keep an fbcp wrapper in br-ext, toggle here. Otherwise leave it off:
# BR2_PACKAGE_FBCP=y

##### End
